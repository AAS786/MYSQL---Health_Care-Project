
--- updates the contact number of the patient with PatientID = 1.
UPDATE Patients
SET ContactNumber = '9876543225'
WHERE PatientID = 1;

--- Find the total amount billed to a specific patient.
SELECT PatientID, SUM(Amount) AS TotalAmount
FROM Billing
WHERE PatientID = 1
GROUP BY PatientID;

--- Find doctors who have seen more than 2 patients.
SELECT D.FirstName, D.LastName, COUNT(A.PatientID) AS NumberOfPatients
FROM Doctors D
JOIN Appointments A ON D.DoctorID = A.DoctorID
GROUP BY D.DoctorID
HAVING COUNT(A.PatientID) > 2;

--- Find the names of patients who have appointments with specific doctors.
SELECT FirstName, LastName
FROM Patients
WHERE PatientID IN (
    SELECT PatientID 
    FROM Appointments
    WHERE DoctorID IN (1, 2, 3)
);

--- the status of the appointment with AppointmentID = 2 to 'PENDING'.
UPDATE Appointments
SET Status = 'PENDING'
WHERE AppointmentID = 2;

--- query selects all doctors who specialize in Cardiology.
SELECT * FROM Doctors
WHERE Specialty = 'Cardiology';

--- query retrieves all patients whose last names start with the letter 'S'.
SELECT * FROM Patients
WHERE LastName LIKE 'S%';

--- query selects all appointments scheduled between August 1st and August 10th, 2024.
SELECT * FROM Appointments
WHERE AppointmentDate BETWEEN '2024-08-01 00:00:00' AND '2024-08-10 23:59:59';

--- query retrieves all medical records where the diagnosis includes the word "Flu".
SELECT * FROM MedicalRecords
WHERE Diagnosis LIKE '%Flu%';

--- query updates the contact number and email of the doctor with DoctorID = 5
UPDATE Doctors
SET ContactNumber = '9876543226', Email = 'vikram.kapoor_updated@example.com'
WHERE DoctorID = 5;

--- query retrieves all hospital staff who work in the department with DepartmentID = 3
SELECT * FROM HospitalStaff
WHERE DepartmentID = 3;

--- retrieves the 3 most recent appointments by ordering the Appointments IN desc
SELECT * FROM Appointments
ORDER BY AppointmentDate DESC
LIMIT 3;

--- Retrieve the names of patients who have had appointments with a doctor specializing in "Cardiology."
SELECT FirstName, LastName FROM Patients
WHERE PatientID IN (
    SELECT PatientID FROM Appointments
    WHERE DoctorID IN (SELECT DoctorID  FROM Doctors 
        WHERE Specialty = 'Cardiology'
    )
);

--- Retrieve the PatientID and FirstName of patients who have a pending appointment and 
---- are under the care of the head doctor of the "Neurology" department.

SELECT PatientID, FirstName FROM Patients
WHERE PatientID IN (
    SELECT PatientID 
    FROM Appointments
    WHERE Status = 'Pending'
    AND DoctorID = (
        SELECT HeadDoctorID
        FROM Departments
        WHERE DepartmentName = 'Neurology'
    )
);



-- Select Statement: --
--- Select All Columns from a Table
SELECT FirstName, LastName FROM Doctors;

--- Select Specific Columns from a Table
SELECT FirstName, LastName FROM Doctors;

-- Where Clauses: --
--- Filter ALL Records Using WHERE Clause
SELECT * FROM Patients WHERE Gender = 'Female';

--- Filter Specific Columns Using WHERE Clause
SELECT FirstName, LastName FROM Doctors WHERE FirstName ='DR. Ravi';

-- Order By : --
-- Sorts the result set in ascending or descending order. ASC FOR Ascending Order & DESC For Descending Order --
SELECT * FROM Patients ORDER BY LastName ASC;

-- Count Function : --
--- Returns the number of rows that match a specified condition. Count(*) || Count(Column_Name)  || Count(1/2..) 
SELECT COUNT(*) FROM Appointments;

-- Aggregate Functions:  SUM, AVG, MIN, MAX --
--- Sum():Returns the sum of a numeric column.
--- Avg():Returns the average value of a numeric column.
--- Min():Returns the minimum value of a column.
--- Max():Returns the maximum value of a column.
SELECT SUM(Amount) AS TotalBilling FROM Billing;
SELECT Avg(Amount) AS AvgBilling FROM Billing;
SELECT Max(Amount) AS HighestBilling FROM Billing;
SELECT Min(Amount) AS LowestBilling FROM Billing;

-- Subqueries :--
-- Question: Retrieve doctors who have appointments scheduled after '2023-01-01'
SELECT FirstName, LastName FROM Doctors
WHERE DoctorID IN (SELECT DoctorID FROM Appointments WHERE AppointmentDate > '2023-01-01');

-- Joins : --
--- Question: Retrieve patients who have never had an appointment. names for all appointments.
SELECT P.FirstName, P.LastName
FROM Patients P
LEFT JOIN Appointments A ON P.PatientID = A.PatientID
WHERE A.AppointmentDate IS NULL;

--- Question: Retrieve patients' names along with their doctors' names for all appointments.
SELECT P.FirstName AS PatientFirstName, P.LastName AS PatientLastName, D.FirstName AS DoctorFirstName, D.LastName AS DoctorLastName
FROM Appointments A
INNER JOIN Patients P ON A.PatientID = P.PatientID
INNER JOIN Doctors D ON A.DoctorID = D.DoctorID;

--  GROUP BY: -- 
--- Question: Count the number of patients by gender.
SELECT Gender, COUNT(*) AS NumberOfPatients
FROM Patients
GROUP BY Gender;

-- HAVING Clause :--
--- Question: Retrieve doctors who have more than 10 appointments.
SELECT DoctorID, COUNT(*) AS AppointmentCount
FROM Appointments
GROUP BY DoctorID
HAVING COUNT(*) > 10;

-- Union / Union All Operator : --
--- Question: Retrieve names from both the Doctors and Patients tables.
SELECT FirstName, LastName FROM Doctors
UNION
SELECT FirstName, LastName FROM Patients;

--- Retrieve patients with pending appointments.
SELECT P.FirstName, P.LastName
FROM Patients P
WHERE EXISTS (SELECT 1 FROM Appointments A WHERE A.PatientID = P.PatientID AND A.Status = 'Pending');

-- We have covered almost all main topics used in SQL and here  are some question to practice in health System Project 
-- Question: List all patients' names and their contact numbers.
SELECT FirstName, LastName, ContactNumber
FROM Patients;

--- Question: Find the number of male and female Active patients.
SELECT Gender, COUNT(*) AS NumberOfPatients
FROM Patients
Where Status = 'Active'
GROUP BY Gender;

--- Question: List all doctors along with their specialties.
SELECT FirstName, LastName, Specialty
FROM Doctors;

--- Question: Find the number of doctors in each specialty.
SELECT Specialty, COUNT(*) AS NumberOfDoctors
FROM Doctors
GROUP BY Specialty;

--- Question: List the appointments that are still pending (status 'Pending').
SELECT *
FROM Appointments
WHERE Status = 'Pending';

--- Question: Retrieve the details of appointments along with patient and doctor names.
SELECT A.AppointmentID, P.FirstName AS PatientFirstName, P.LastName AS PatientLastName,
       D.FirstName AS DoctorFirstName, D.LastName AS DoctorLastName, A.AppointmentDate
FROM Appointments A
JOIN Patients P ON A.PatientID = P.PatientID
JOIN Doctors D ON A.DoctorID = D.DoctorID;

--- Question: Find the most common diagnosis given by doctors.
SELECT Diagnosis, COUNT(*) AS Frequency
FROM MedicalRecords
GROUP BY Diagnosis
ORDER BY Frequency DESC;

--- Question: Find the medications that have been prescribed the most.
SELECT Medication, COUNT(*) AS PrescriptionCount
FROM Prescriptions
GROUP BY Medication
ORDER BY PrescriptionCount DESC;

--- Question: Retrieve the details of unpaid bills.
SELECT *
FROM Billing
WHERE PaymentStatus = 'Pending';

--- Question: Find the number of staff members in each department.
SELECT Dept.DepartmentName, COUNT(*) AS StaffCount
FROM HospitalStaff HS
JOIN Departments Dept ON HS.DepartmentID = Dept.DepartmentID
GROUP BY Dept.DepartmentName;

